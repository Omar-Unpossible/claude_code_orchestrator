# Default configuration for Claude Code Orchestrator
# This file provides sensible defaults for all settings.
# Override in config/config.yaml or via environment variables.

# Local LLM Configuration (Ollama)
llm:
  type: ollama  # LLM provider type (matches LLMRegistry)
  model: qwen2.5-coder:32b  # Model to use
  api_url: http://172.29.144.1:11434  # Ollama API endpoint
  temperature: 0.7  # Generation temperature (0.0-2.0)
  timeout: 30  # Timeout for generation (seconds)
  max_tokens: 4096  # Maximum tokens to generate
  context_length: 32768  # Model context window size

# Agent Configuration
agent:
  type: mock  # Agent type (mock for testing, claude-code-ssh for production)
  timeout: 120  # Default timeout for agent operations (seconds)
  max_retries: 3  # Maximum retry attempts on failure
  workspace_path: /home/omarwsl/obra-runtime/workspace  # Agent workspace directory

  # SSH-specific config (for claude-code-ssh agent)
  ssh:
    host: localhost
    port: 22
    user: claude
    key_path: ~/.ssh/id_rsa
    # Note: Set via ORCHESTRATOR_AGENT_SSH_KEY_PATH env var for security

  # Docker-specific config (for claude-code-docker agent)
  docker:
    image: claude-code:latest
    container_name: claude-agent
    workspace_mount: ./workspace

# Database Configuration
database:
  url: sqlite:////home/omarwsl/obra-runtime/data/orchestrator.db  # SQLite for simplicity
  # For PostgreSQL: postgresql://user:password@localhost/orchestrator
  pool_size: 10  # Connection pool size
  max_overflow: 20  # Max overflow connections
  echo: false  # Log SQL queries (set true for debugging)

# File Monitoring
monitoring:
  file_watcher:
    enabled: true
    debounce_ms: 500  # Debounce rapid changes
    ignore_patterns:
      - "**/__pycache__/**"
      - "**/.git/**"
      - "**/.venv/**"
      - "**/*.pyc"
      - "**/node_modules/**"

  output_monitor:
    completion_markers:
      - "Task completed"
      - "Done"
      - "Finished"
    error_markers:
      - "Error:"
      - "Failed:"
      - "Exception:"

# Orchestration Settings
orchestration:
  max_iterations: 50  # Maximum iterations per task
  iteration_timeout: 300  # Timeout per iteration (seconds)
  task_timeout: 3600  # Overall task timeout (seconds)
  concurrent_tasks: 1  # Number of tasks to run in parallel
  auto_retry: true  # Automatically retry failed operations

# Breakpoint Configuration
breakpoints:
  enabled: true  # Enable breakpoint system
  auto_resolve_timeout: 300  # Auto-resolve timeout (seconds, 0 = wait forever)

  # When to trigger breakpoints
  triggers:
    low_confidence:
      enabled: true
      threshold: 30  # Confidence below this triggers breakpoint
    quality_too_low:
      enabled: true
      threshold: 50  # Quality score below this triggers breakpoint
    validation_failed:
      enabled: true
      max_retries: 3  # Trigger after this many validation failures
    rate_limit_hit:
      enabled: true
    unexpected_error:
      enabled: true

# Validation Settings
validation:
  response:
    check_completeness: true
    check_code_blocks_closed: true
    min_length: 10  # Minimum response length (characters)

  quality:
    enabled: true
    threshold: 70  # Minimum acceptable quality score (0-100)
    run_tests: true  # Execute tests if applicable
    check_syntax: true  # Validate code syntax

# Confidence Scoring
confidence:
  threshold: 50  # Minimum confidence to proceed without breakpoint
  weights:
    validation: 0.3  # Weight for validation result
    quality: 0.4  # Weight for quality score
    agent_health: 0.1  # Weight for agent health status
    retry_count: 0.2  # Weight for number of retries

# Context Management
context:
  max_tokens: 8000  # Maximum context tokens to include in prompts
  prioritization:
    - recent_interactions  # Most recent interactions (highest priority)
    - task_description  # Current task description
    - relevant_files  # Files mentioned in task
    - project_context  # General project context

  summarization:
    enabled: true  # Summarize old context when limit reached
    keep_recent: 5  # Keep this many recent interactions unsummarized

# Logging
logging:
  level: INFO  # Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  file: /home/omarwsl/obra-runtime/logs/orchestrator.log  # Log file path
  max_bytes: 10485760  # Max log file size (10MB)
  backup_count: 5  # Number of backup files to keep

# Prompt Templates
prompts:
  template_dir: config/prompt_templates  # Directory for Jinja2 templates

# Performance
performance:
  enable_caching: true  # Enable caching where applicable
  cache_ttl: 300  # Cache time-to-live (seconds)

# Development/Debug Settings (disable in production)
debug:
  enabled: false  # Enable debug mode
  save_interactions: true  # Save all interactions for debugging
  verbose_logging: false  # Extra verbose logging
