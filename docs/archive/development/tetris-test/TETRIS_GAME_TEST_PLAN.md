# Tetris Game Development Test Plan

**Date**: 2025-11-05
**Test ID**: test_tetrisgame
**Type**: Multi-Session Integration Test
**Status**: Ready for Execution

## Test Overview

### Purpose

Test Obra's ability to orchestrate a complex, multi-session software development project with Claude Code, specifically:

1. **Multi-session orchestration**: Progressive prompts across multiple tasks/sessions
2. **Planning & decomposition**: Claude generates milestone breakdown autonomously
3. **Complex file structures**: Godot 4.5 project with scenes, scripts, configs
4. **Documentation generation**: Agents produce all necessary project documentation
5. **Iterative refinement**: Handle bugs, syntax errors, and API mismatches through iteration
6. **Headless development**: Build interactive software without visual tools

### Scope

**Project**: Tetris clone game using Godot 4.5 engine
**Location**: `/projects/test_tetrisgame/`
**Development Mode**: Headless (no GUI tools, file-based only)
**Time Limit**: None (test Obra's endurance and multi-session handling)

---

## Test Requirements

### Functional Requirements

**Game Features** (Minimal Viable Product):

1. **Title Screen**
   - Display "Tetris Clone" or similar title
   - "Play Now" button to start game

2. **Game Scene**
   - Grid/playfield (standard 10 wide × 20 tall)
   - 7 tetromino shapes (I, O, T, S, Z, J, L)
   - Falling blocks from top
   - Keyboard controls:
     - Left/Right: Translate piece
     - Rotate: Rotate piece (clockwise/counterclockwise)
     - Down: Soft drop
     - Space: Hard drop (optional)
   - Row clearing when line is complete
   - Scoring system (points based on rows cleared simultaneously)
   - Gravity (blocks fall automatically over time)

3. **Game Over Condition**
   - Detect when blocks reach top of playfield
   - Transition to score screen

4. **Score Screen**
   - Display final score
   - "Play Again?" prompt
   - Return to title screen or restart game

### Technical Requirements

1. **Engine**: Godot 4.5 (headless mode)
2. **Language**: GDScript
3. **Graphics**: Minimal (ColorRect nodes acceptable, no polished sprites)
4. **Testing**: Unit tests for core game logic
5. **Documentation**: Generated by agents (README, design docs, etc.)

### Non-Requirements (Out of Scope)

- ❌ Polished graphics or animations
- ❌ Sound effects or music
- ❌ Multiplayer
- ❌ Save/load functionality
- ❌ Leaderboards
- ❌ Advanced features (hold piece, ghost piece, etc.)

---

## Test Constraints & Decisions

### Development Environment

**Constraint**: Headless development only
- **Rationale**: Claude Code cannot use visual GUI tools
- **Implication**: All work done through file creation/editing + CLI commands
- **Testing**: Relies on unit tests, headless runs, and log analysis

**Decision**: Pure headless development accepted
- No visual verification during development
- Visual playthrough only after completion (manual, not part of test)

### Graphics & Polish

**Constraint**: Minimal graphics acceptable
- **Rationale**: Focus is on functionality, not aesthetics
- **Implementation**: Simple `ColorRect` nodes (7 colors for 7 tetromino types)
- **No asset pipeline**: No sprites, textures, or complex rendering

**Decision**: Function over form - basic visuals sufficient

### Testing & Validation

**Constraint**: No user playthroughs during development
- **Rationale**: Headless mode prevents interactive testing
- **Alternatives**:
  - Unit tests for game logic (rotation, collision, scoring)
  - Headless execution logs (check for errors/warnings)
  - Scene validation (scenes load without crashes)
  - Code review (logic matches Tetris rules)

**Decision**: "Passing" criteria = runs without errors + logic tests pass + reasonable assumptions

### Milestone Planning

**Constraint**: Agents must generate the breakdown
- **Rationale**: Test Obra's ability to prompt Claude for planning
- **NOT seeded**: We do not provide milestone structure
- **Claude decides**: Number of milestones, deliverables, order

**Decision**: Let agents decompose the problem autonomously

### Multi-Session Orchestration

**Constraint**: NOT a single-prompt task
- **Rationale**: Tetris clone is 10-20 hours of work (too large for one session)
- **Approach**: Obra issues progressive prompts across multiple sessions
- **Turn limits**: Apply per prompt-response cycle (10-20 turns), not total project

**Decision**: Test Obra's multi-session capabilities (this is the core strength)

### Documentation

**Constraint**: Agents responsible for all documentation
- **Rationale**: Test autonomous documentation generation
- **Scope**: Agents decide what's needed (README, design docs, API docs, etc.)
- **Depth**: Appropriate for the project (we don't specify)

**Decision**: Let agents determine documentation requirements

---

## Expected Challenges & Risks

### 1. **Godot 4.5 Knowledge Gaps**

**Challenge**: Claude's training may have limited Godot 4.5 examples
- Godot 4.x introduced significant changes from 3.x
- API differences, TSCN format changes

**Mitigation**:
- Claude can research (web search, documentation)
- Iterative refinement through trial-error-fix cycles
- Obra's multi-session approach allows learning over time

**Risk Level**: Medium (manageable through iteration)

### 2. **TSCN File Format**

**Challenge**: `.tscn` files have specific syntax/structure
- Node hierarchy must be correct
- Properties must match Godot's expectations
- Easy to make syntax errors

**Mitigation**:
- Start simple (minimal scenes)
- Validate with `godot --headless --check-only`
- Iterate based on error messages

**Risk Level**: Medium-High (syntax errors likely in early iterations)

### 3. **Headless Testing Limitations**

**Challenge**: Cannot see the game visually during development
- No feedback on layout, colors, positioning
- Difficult to verify gameplay "feel"
- Input handling can't be tested interactively

**Mitigation**:
- Focus on logic correctness (testable)
- Use unit tests for all game mechanics
- Accept that visual polish is not required

**Risk Level**: Low (acceptable given test constraints)

### 4. **Complexity & Scope**

**Challenge**: Tetris is deceptively complex
- Multiple systems (grid, blocks, input, scoring, UI, scenes)
- State management across scenes
- Collision detection, rotation, line clearing algorithms

**Mitigation**:
- Milestone-based approach (decompose into phases)
- Each milestone builds on previous
- Allow agents to adjust scope if needed

**Risk Level**: Medium (scope creep possible, but milestones help)

### 5. **Turn Limits per Session**

**Challenge**: Each prompt-response cycle limited to 10-20 turns
- Complex tasks may hit limit
- Max turns retry logic will extend (2x multiplier)

**Mitigation**:
- Break work into smaller tasks
- Use milestones to create natural breakpoints
- Obra's retry logic provides buffer

**Risk Level**: Low (multi-session design handles this)

---

## Success Criteria

### Minimum Success (MVP)

✅ **Project runs without crashes**
- `godot --headless --path /projects/test_tetrisgame` executes successfully
- No fatal errors in logs

✅ **Core game logic works**
- Unit tests pass for:
  - Tetromino rotation
  - Collision detection
  - Line clearing
  - Scoring calculation
- Logic matches standard Tetris rules

✅ **All scenes load**
- Main menu scene loads
- Game scene loads
- Game over scene loads
- Scene transitions work (no crashes)

✅ **Documentation exists**
- README with project overview
- Basic design documentation
- Code comments for complex logic

### Full Success

✅ All minimum criteria met, plus:

✅ **Playable game** (manual verification)
- Can start game from menu
- Blocks fall and respond to input
- Rows clear when filled
- Game over detection works
- Can restart after game over

✅ **Comprehensive tests**
- >80% code coverage for game logic
- Integration tests for scene management

✅ **Complete documentation**
- Game design document
- Architecture overview
- API/code documentation
- Development log/notes

### Failure Conditions

❌ **Critical failures**:
- Project doesn't run at all
- Core logic tests fail
- Scenes fail to load
- No documentation produced

❌ **Partial failures** (acceptable with good iteration):
- Some tests fail but logic mostly works
- Minor syntax errors in scenes
- Incomplete documentation

---

## Test Execution Plan

### Pre-Execution Checklist

**Before starting test:**

1. ✅ Verify Godot installation
   ```bash
   godot --version  # Should show 4.5.x
   godot --headless --version  # Confirm headless mode
   ```

2. ✅ Confirm target directory doesn't exist
   ```bash
   ls /projects/test_tetrisgame  # Should not exist
   ```

3. ✅ Verify Obra configuration
   - Simplified decision logic active (Nov 2025 update)
   - Max turns settings appropriate (10-20 per task)
   - Session management enabled

4. ✅ Prepare test environment
   ```bash
   # Clean any leftover test data
   rm -rf /projects/test_tetrisgame
   ```

### Execution Phases

**Phase 1: Project Initialization**

**Task**: Create Obra project and initial prompt

```bash
# Create Obra project
python -m src.cli project create "Tetris Game Development Test"

# Note project ID (will be used for tasks)
```

**Phase 2: Milestone Planning Task**

**Task**: Prompt Claude to generate milestone breakdown

```bash
# Create task with planning prompt
python -m src.cli task create \
  --project <PROJECT_ID> \
  --type planning \
  --description "Generate milestone breakdown for Tetris game"
```

**Expected Output**:
- Claude generates 4-6 milestones
- Each milestone has clear deliverables
- Documentation structure outlined

**Phase 3: Execute Milestones**

**For each milestone** (created as separate Obra tasks):

```bash
# Create task for milestone
python -m src.cli task create \
  --project <PROJECT_ID> \
  --type code_generation \
  --description "Implement Milestone N: <milestone_name>"

# Execute task
python -m src.cli task execute <TASK_ID>
```

**Repeat** until all milestones complete or critical failure occurs.

**Phase 4: Validation**

**Manual validation steps**:

1. Run headless test
   ```bash
   godot --headless --path /projects/test_tetrisgame --quit
   ```

2. Check for errors in output

3. Run unit tests (if test script exists)
   ```bash
   godot --headless --path /projects/test_tetrisgame --script tests/run_tests.gd
   ```

4. Review generated files
   ```bash
   tree /projects/test_tetrisgame
   ```

5. Check documentation completeness
   ```bash
   cat /projects/test_tetrisgame/README.md
   ```

6. (Optional) Visual playthrough
   ```bash
   godot --path /projects/test_tetrisgame
   ```

---

## Seeding Prompt for Obra

### Initial Prompt (Planning Phase)

**Prompt to give to Obra** (via CLI or interactive mode):

```
Create a Tetris clone game using the Godot 4.5 game engine. The project should be located at /projects/test_tetrisgame/.

REQUIREMENTS:
1. Develop the game entirely in headless mode (no GUI tools - file creation and CLI only)
2. The game must include:
   - Title screen with "Play Now" button
   - Main game scene with Tetris gameplay (falling blocks, rotation, translation via keyboard, row clearing, scoring)
   - Game over detection and score display
   - "Play Again?" functionality to restart
3. Use minimal graphics (simple ColorRect nodes are acceptable - no polished sprites needed)
4. Implement unit tests for core game logic (rotation, collision detection, line clearing, scoring)
5. Generate all necessary project documentation (README, design docs, etc.)

FIRST TASK:
Break this project down into logical milestones with clear deliverables for each milestone. Create a development plan that can be executed iteratively across multiple work sessions.

For each milestone, specify:
- Milestone name and number
- Deliverables (files, features, tests)
- Success criteria
- Dependencies on previous milestones

After creating the milestone plan, we will execute each milestone as a separate task.
```

### Subsequent Prompts (Milestone Execution)

**For each milestone** (after planning phase):

```
Implement Milestone N: <milestone_name>

DELIVERABLES:
<list from milestone plan>

CONSTRAINTS:
- Headless development only (use file creation/editing and CLI commands)
- Test all logic with unit tests
- Document your work (code comments, update README)

VALIDATION:
- Run godot --headless to check for errors
- Ensure unit tests pass
- Verify scene files load correctly
```

---

## Monitoring & Metrics

### Metrics to Track

**Throughout execution:**

1. **Session count**: Number of Obra task executions
2. **Iteration count**: Total iterations across all sessions
3. **Decision distribution**:
   - PROCEED rate
   - CLARIFY rate
   - ESCALATE rate
   - RETRY rate
4. **Quality scores**: Average LLM quality scores per milestone
5. **Time per milestone**: Wall-clock time for each phase
6. **Error recovery**: Number of syntax errors, API errors, etc. and how many iterations to fix

**Post-execution:**

1. **Files created**: Count and type
2. **Lines of code**: Total GDScript lines
3. **Test coverage**: Percentage of game logic tested
4. **Documentation pages**: Number and type of docs generated

### Log Files

**Capture for analysis:**

```bash
# Obra logs
tail -f logs/orchestrator.log

# Test execution logs
tee /tmp/tetris_test_output.log

# Godot error logs (if any)
cat /projects/test_tetrisgame/.godot/logs/*
```

---

## Lessons Learned (Post-Test)

**To be filled after test completion:**

### What Worked

- [Record successful strategies]
- [Effective milestone breakdowns]
- [Good testing approaches]

### What Didn't Work

- [Challenges encountered]
- [Failures and root causes]
- [Unexpected limitations]

### Improvements for Future Tests

- [Configuration adjustments]
- [Prompt improvements]
- [Process refinements]

### Obra Performance

- [Multi-session handling effectiveness]
- [Decision logic performance]
- [Quality scoring accuracy]
- [Session management issues]

---

## Test Artifacts

### Expected Outputs

**Project Files** (in `/projects/test_tetrisgame/`):
```
test_tetrisgame/
├── project.godot               # Godot project config
├── README.md                   # Project documentation
├── DESIGN.md                   # Game design document (if created)
├── scenes/
│   ├── main_menu.tscn         # Title screen
│   ├── game.tscn              # Main gameplay
│   └── game_over.tscn         # End screen
├── scripts/
│   ├── game_logic.gd          # Core game mechanics
│   ├── tetromino.gd           # Block/piece class
│   ├── grid.gd                # Grid/playfield manager
│   ├── main_menu.gd           # Menu controller
│   └── game_over.gd           # Game over controller
├── tests/
│   ├── test_game_logic.gd     # Unit tests for logic
│   ├── test_tetromino.gd      # Tests for tetromino class
│   └── test_grid.gd           # Tests for grid class
└── docs/ (optional)
    └── architecture.md        # Architecture documentation
```

**Test Reports**:
- Execution logs in Obra database
- Session summaries
- Quality metrics
- Decision distributions

**Analysis Documents**:
- Lessons learned summary
- Performance analysis
- Comparison to baseline (CSV test)

---

## Acceptance

### Test Owner
- **Name**: Omar (Unpossible Creations)
- **Date**: 2025-11-05

### Sign-Off Criteria

Test is considered **successful** if:

1. ✅ Project runs without fatal errors
2. ✅ Core game logic tests pass
3. ✅ All scenes load successfully
4. ✅ Documentation is generated
5. ✅ Obra completes multi-session orchestration without critical failures

Test is considered **acceptable with issues** if:

1. ⚠️ Project runs but has minor bugs
2. ⚠️ Most tests pass (>80%)
3. ⚠️ Scenes load but have rendering issues
4. ⚠️ Documentation is incomplete but present

Test is considered **failed** if:

1. ❌ Project doesn't run at all
2. ❌ Core logic tests fail completely
3. ❌ No documentation produced
4. ❌ Obra cannot handle multi-session workflow

---

## References

- **Godot 4.5 Documentation**: https://docs.godotengine.org/en/stable/
- **GDScript Guide**: https://docs.godotengine.org/en/stable/tutorials/scripting/gdscript/
- **Tetris Guidelines**: https://tetris.wiki/Tetris_Guideline
- **Obra Documentation**: `docs/architecture/ARCHITECTURE.md`
- **Decision Logic**: `docs/development/DECISION_LOGIC_SIMPLIFICATION_SUMMARY.md`

---

**Status**: ✅ Ready for Execution
**Next Action**: Run pre-execution checklist, then execute Phase 1 (project initialization)
**Last Updated**: 2025-11-05
